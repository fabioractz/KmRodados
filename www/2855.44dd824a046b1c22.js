"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2855],{2855(D,C,d){d.d(C,{K:()=>B});var v=d(467),b=d(5083),P=d(8254);const f=(0,b.F3)("Geolocation",{web:()=>d.e(2920).then(d.bind(d,2920)).then(c=>new c.GeolocationWeb)});(0,P.Y)();var h=d(9350),S=d(7707),e=d(3664),n=d(2615),i=d(7343),r=d(9198),u=d(6991),y=d(5355),V=d(9330),F=d(6354);let k=(()=>{var c;class m{constructor(t){this.http=t,this.url_overpass="https://overpass-api.de/api/interpreter",this.raio_metros=3e3,this.limite_resultados=10}obterPostosProximos(t,o){const a='[out:json][timeout:25];node["amenity"="fuel"](around:'.concat(this.raio_metros,",").concat(t,",").concat(o,");out body ").concat(this.limite_resultados,";"),s=(new V.Nl).set("data",a);return this.http.get(this.url_overpass,{params:s}).pipe((0,F.T)(g=>this.mapearResposta(g)))}getNearbyStations(t,o){return this.obterPostosProximos(t,o)}mapearResposta(t){return t&&Array.isArray(t.elements)?t.elements.filter(a=>a&&"node"===a.type).map(a=>{const s=a.tags||{},g=[];s["addr:street"]&&g.push(s["addr:street"]),s["addr:housenumber"]&&g.push(s["addr:housenumber"]);const _=g.join(", ");return{name:s.name||"Posto sem nome",address:_,lat:a.lat,lng:a.lon}}).slice(0,this.limite_resultados):[]}}return(c=m).\u0275fac=function(t){return new(t||c)(n.KVO(V.Qq))},c.\u0275prov=n.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}),m})();var j=d(2200),O=d(4341);function T(c,m){if(1&c&&(e.j41(0,"ion-select-option",22),e.EFF(1),e.nI1(2,"uppercase"),e.k0s()),2&c){const p=m.$implicit;e.Y8G("value",p.plate),e.R7$(),e.Lme("",p.model," (",e.bMT(2,3,p.plate),")")}}function w(c,m){if(1&c){const p=e.RV6();e.j41(0,"ion-datetime",23),e.mxI("ngModelChange",function(o){n.eBV(p);const a=e.XpG();return e.DH7(a.supplyDate,o)||(a.supplyDate=o),n.Njj(o)}),e.k0s()}if(2&c){const p=e.XpG();e.R50("ngModel",p.supplyDate)}}function L(c,m){if(1&c){const p=e.RV6();e.j41(0,"ion-datetime",24),e.mxI("ngModelChange",function(o){n.eBV(p);const a=e.XpG();return e.DH7(a.horaAbastecimento,o)||(a.horaAbastecimento=o),n.Njj(o)}),e.k0s()}if(2&c){const p=e.XpG();e.R50("ngModel",p.horaAbastecimento)}}function N(c,m){1&c&&(e.j41(0,"ion-item",25)(1,"ion-label"),e.EFF(2,"Buscando postos pr\xf3ximos..."),e.k0s(),e.nrm(3,"ion-spinner",26),e.k0s())}function U(c,m){if(1&c&&(e.j41(0,"ion-item",25)(1,"ion-label",27),e.EFF(2),e.k0s()()),2&c){const p=e.XpG();e.R7$(2),e.JRh(p.mensagemErroPostos)}}function G(c,m){if(1&c){const p=e.RV6();e.j41(0,"ion-item",30),e.bIt("click",function(){const o=n.eBV(p).$implicit,a=e.XpG(2);return n.Njj(a.selecionarPosto(o))}),e.j41(1,"div",31)(2,"span"),e.EFF(3),e.k0s()(),e.j41(4,"ion-label")(5,"div",32),e.EFF(6),e.k0s(),e.j41(7,"div",33),e.EFF(8),e.k0s()()()}if(2&c){const p=m.$implicit,t=m.index,o=e.XpG(2);e.AVh("item-zebrado",t%2==1),e.R7$(),e.Y8G("ngClass",o.obter_classe_logo_posto(p)),e.R7$(2),e.JRh(o.obter_texto_logo_posto(p)),e.R7$(3),e.JRh(p.name),e.R7$(2),e.JRh(p.address||"n\xe3o informado")}}function z(c,m){if(1&c&&(e.j41(0,"ion-list",28),e.DNE(1,G,9,6,"ion-item",29),e.k0s()),2&c){const p=e.XpG();e.R7$(),e.Y8G("ngForOf",p.postosProximos)}}function H(c,m){if(1&c&&(e.j41(0,"ion-select-option",22),e.EFF(1),e.k0s()),2&c){const p=m.$implicit;e.Y8G("value",p),e.R7$(),e.JRh(p)}}let B=(()=>{var c;class m{constructor(t,o,a,s,g,_,M){this.modalCtrl=t,this.vehicleService=o,this.alertCtrl=a,this.toastCtrl=s,this.router=g,this.ajuda_odometro=_,this.gasStationService=M,this.vehicles=[],this.editingSupply=null,this.editingVehiclePlate=null,this.supplyDate="",this.horaAbastecimento="",this.selectedVehiclePlate="",this.gasStation="",this.initialOdometer=null,this.tipoAbastecimento="",this.opcoesAbastecimento=["Gasolina Comum","Gasolina Aditivada","Gasolina Premium/Podium","Etanol","Diesel S10","Diesel S500","GNV","Outro"],this.precoPorLitro=null,this.liters=null,this.totalValue=null,this.totalValueStr="",this.motorista="",this.observations="",this.isEditing=!1,this.postosProximos=[],this.exibindoListaPostos=!1,this.exibindoCarregandoPostos=!1,this.mensagemErroPostos=null}ngOnInit(){if(this.initDate(),this.editingSupply&&this.editingVehiclePlate)this.isEditing=!0,this.loadSupply(this.editingSupply);else if(this.vehicles.length>0)if(this.editingVehiclePlate)this.selectedVehiclePlate=this.editingVehiclePlate;else{const t=this.vehicles.find(o=>o.isDefault);this.selectedVehiclePlate=t?t.plate:this.vehicles[0].plate}}set preSelectedPlate(t){t&&(this.selectedVehiclePlate=t)}initDate(){const t=new Date,o=6e4*t.getTimezoneOffset(),a=new Date(t.getTime()-o).toISOString();this.supplyDate=a,this.horaAbastecimento=a}loadSupply(t){var o;this.selectedVehiclePlate=this.editingVehiclePlate;const a=new Date(t.date),s=6e4*a.getTimezoneOffset(),g=new Date(a.getTime()-s).toISOString();this.supplyDate=g,this.horaAbastecimento=g,this.gasStation=t.gasStation||"",this.initialOdometer=t.initialOdometer||null,this.tipoAbastecimento=t.tipoAbastecimento||"";const _=t.liters,M=t.totalValue;this.precoPorLitro=null!==(o=t.precoPorLitro)&&void 0!==o?o:_&&M&&_>0?M/_:null,this.liters=t.liters||null,this.totalValue=t.totalValue||null,this.totalValue&&(this.totalValueStr=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(this.totalValue)),this.motorista=t.motorista||"",this.observations=t.observations||""}obter_classe_logo_posto(t){const o=((null==t?void 0:t.name)||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return o.includes("ipiranga")?"ipiranga":o.includes("petrobras")||o.includes("petrobr")?"petrobras":o.includes("shell")?"shell":""}obter_texto_logo_posto(t){var o;const a=((null==t?void 0:t.name)||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");if(a.includes("ipiranga"))return"I";if(a.includes("petrobras")||a.includes("petrobr"))return"BR";if(a.includes("shell"))return"S";const s=null==t||null===(o=t.name)||void 0===o||null===(o=o.trim())||void 0===o?void 0:o.charAt(0);return s?s.toUpperCase():"P"}aoFocarCampoPosto(){var t=this;return(0,v.A)(function*(){if(!t.exibindoCarregandoPostos){t.mensagemErroPostos=null,t.exibindoListaPostos=!1,t.exibindoCarregandoPostos=!0;try{let o=yield f.checkPermissions();if(("denied"===o.location||"prompt"===o.location)&&(o=yield f.requestPermissions()),"denied"===o.location)return void(t.mensagemErroPostos="Permiss\xe3o de localiza\xe7\xe3o negada. Voc\xea pode digitar o posto manualmente.");const a=yield f.getCurrentPosition({enableHighAccuracy:!0,timeout:15e3}),s=a.coords.latitude,g=a.coords.longitude,_=yield function l(c,m){const p="object"==typeof m;return new Promise((t,o)=>{const a=new S.Ms({next:s=>{t(s),a.unsubscribe()},error:o,complete:()=>{p?t(m.defaultValue):o(new h.G)}});c.subscribe(a)})}(t.gasStationService.getNearbyStations(s,g));t.postosProximos=_,t.exibindoListaPostos=t.postosProximos.length>0}catch{t.mensagemErroPostos="N\xe3o foi poss\xedvel buscar postos pr\xf3ximos. Verifique sua conex\xe3o e tente novamente."}finally{t.exibindoCarregandoPostos=!1}}})()}selecionarPosto(t){this.gasStation=t.name,this.exibindoListaPostos=!1}aoDigitarPosto(){this.exibindoListaPostos=!1}atualizarLitrosAutomaticamente(){const t=null!=this.precoPorLitro?Number(this.precoPorLitro):NaN,o=null!=this.totalValue?Number(this.totalValue):NaN;!isNaN(t)&&t>0&&!isNaN(o)&&o>0&&(this.liters=Number((o/t).toFixed(3)))}aoAlterarPrecoPorLitro(){null!=this.precoPorLitro&&(this.precoPorLitro=Number(this.precoPorLitro)),this.atualizarLitrosAutomaticamente()}close(){this.modalCtrl.dismiss()}formatCurrency(t){let o=t.target.value;if(o=o.replace(/\D/g,""),""===o)return this.totalValueStr="",void(this.totalValue=null);const a=parseInt(o,10)/100;this.totalValue=a,this.totalValueStr=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a),this.atualizarLitrosAutomaticamente()}save(){var t=this;return(0,v.A)(function*(){var o,a,s;if(!t.selectedVehiclePlate||!t.supplyDate)return void(yield(yield t.alertCtrl.create({header:"Campos Obrigat\xf3rios",message:"Por favor, selecione um ve\xedculo e informe a data.",buttons:["OK"]})).present());const g=t.supplyDate.split("T")[0],[_,M,$]=g.split("-").map(Number);let A=0,I=0;const R=t.horaAbastecimento||t.supplyDate;if(R){const X=(R.split("T")[1]||"").split(".")[0]||"",[W,J]=X.split(":");A=Number(W)||0,I=Number(J)||0}const K=new Date(_,M-1,$,A,I);let E=null!=t.precoPorLitro?Number(t.precoPorLitro):null;(null==E||isNaN(E))&&t.liters&&t.totalValue&&t.liters>0&&(E=t.totalValue/t.liters);const x={id:t.isEditing?t.editingSupply.id:void 0,date:K,gasStation:t.gasStation,initialOdometer:null!==(o=t.initialOdometer)&&void 0!==o?o:void 0,tipoAbastecimento:t.tipoAbastecimento||void 0,precoPorLitro:null!=E?E:void 0,liters:null!==(a=t.liters)&&void 0!==a?a:void 0,totalValue:null!==(s=t.totalValue)&&void 0!==s?s:void 0,motorista:t.motorista||void 0,observations:t.observations};t.isEditing?t.vehicleService.updateSupply(t.selectedVehiclePlate,x):t.vehicleService.addSupply(t.selectedVehiclePlate,x),yield(yield t.toastCtrl.create({message:t.isEditing?"Abastecimento atualizado com sucesso!":"Abastecimento registrado com sucesso!",duration:2e3,position:"bottom",color:"success"})).present(),t.modalCtrl.dismiss({saved:!0})})()}viewHistory(){this.modalCtrl.dismiss({action:"view_history"})}}return(c=m).\u0275fac=function(t){return new(t||c)(e.rXU(i.W3),e.rXU(r.K),e.rXU(i.hG),e.rXU(i.K_),e.rXU(u.Ix),e.rXU(y.k),e.rXU(k))},c.\u0275cmp=e.VBU({type:c,selectors:[["app-supply-modal"]],inputs:{vehicles:"vehicles",editingSupply:"editingSupply",editingVehiclePlate:"editingVehiclePlate",preSelectedPlate:"preSelectedPlate"},standalone:!1,decls:60,vars:18,consts:[["slot","end"],[3,"click"],[1,"ion-padding"],["label","Ve\xedculo","label-placement","stacked",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["position","stacked"],["datetime","supply-data"],[3,"keepContentsMounted"],["datetime","supply-hora"],["label","Posto","label-placement","stacked","placeholder","Nome do posto",3,"ngModelChange","ionFocus","ionInput","ngModel"],["lines","none",4,"ngIf"],["class","lista-posto-autocomplete",4,"ngIf"],["tabindex","0",1,"icone-ajuda-odometro",3,"click"],["type","number","inputmode","numeric",3,"ngModelChange","ngModel"],["label","Abastecimento","label-placement","stacked","interface","action-sheet",3,"ngModelChange","ngModel"],["type","number","inputmode","decimal","label","Pre\xe7o/L (R$)","label-placement","stacked",3,"ngModelChange","ionInput","ngModel"],["type","tel","inputmode","decimal","label","Valor (R$)","label-placement","stacked","placeholder","R$ 0,00",3,"ngModelChange","ionInput","ngModel"],["type","number","inputmode","decimal","label","Litros","label-placement","stacked",3,"ngModelChange","ngModel"],["label","Motorista","label-placement","stacked","placeholder","Nome do motorista",3,"ngModelChange","ngModel"],["label","Observa\xe7\xf5es","label-placement","stacked",3,"ngModelChange","ngModel"],["expand","block",1,"ion-margin-top",3,"click"],["expand","block","fill","outline",1,"ion-margin-top",3,"click"],[3,"value"],["id","supply-data","presentation","date","locale","pt-BR",3,"ngModelChange","ngModel"],["id","supply-hora","presentation","time","locale","pt-BR",3,"ngModelChange","ngModel"],["lines","none"],["slot","end","name","crescent"],["color","danger"],[1,"lista-posto-autocomplete"],["button","","detail","false",3,"item-zebrado","click",4,"ngFor","ngForOf"],["button","","detail","false",3,"click"],["slot","start",1,"logo-posto",3,"ngClass"],[1,"nome-posto"],[1,"endereco-posto"]],template:function(t,o){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",0)(5,"ion-button",1),e.bIt("click",function(){return o.close()}),e.EFF(6,"Fechar"),e.k0s()()()(),e.j41(7,"ion-content",2)(8,"ion-item")(9,"ion-select",3),e.mxI("ngModelChange",function(s){return e.DH7(o.selectedVehiclePlate,s)||(o.selectedVehiclePlate=s),s}),e.DNE(10,T,3,5,"ion-select-option",4),e.k0s()(),e.j41(11,"ion-grid")(12,"ion-row")(13,"ion-col")(14,"ion-item")(15,"ion-label",5),e.EFF(16,"Data"),e.k0s(),e.nrm(17,"ion-datetime-button",6),e.j41(18,"ion-modal",7),e.DNE(19,w,1,1,"ng-template"),e.k0s()()(),e.j41(20,"ion-col")(21,"ion-item")(22,"ion-label",5),e.EFF(23,"Hora"),e.k0s(),e.nrm(24,"ion-datetime-button",8),e.j41(25,"ion-modal",7),e.DNE(26,L,1,1,"ng-template"),e.k0s()()()()(),e.j41(27,"ion-item")(28,"ion-input",9),e.mxI("ngModelChange",function(s){return e.DH7(o.gasStation,s)||(o.gasStation=s),s}),e.bIt("ionFocus",function(){return o.aoFocarCampoPosto()})("ionInput",function(){return o.aoDigitarPosto()}),e.k0s()(),e.DNE(29,N,4,0,"ion-item",10)(30,U,3,1,"ion-item",10)(31,z,2,1,"ion-list",11),e.j41(32,"ion-item")(33,"ion-label",5),e.EFF(34," Od\xf4metro (Km) "),e.j41(35,"span",12),e.bIt("click",function(s){return o.ajuda_odometro.mostrarAjudaOdometro(s)}),e.EFF(36,"?"),e.k0s()(),e.j41(37,"ion-input",13),e.mxI("ngModelChange",function(s){return e.DH7(o.initialOdometer,s)||(o.initialOdometer=s),s}),e.k0s()(),e.j41(38,"ion-item")(39,"ion-select",14),e.mxI("ngModelChange",function(s){return e.DH7(o.tipoAbastecimento,s)||(o.tipoAbastecimento=s),s}),e.DNE(40,H,2,2,"ion-select-option",4),e.k0s()(),e.j41(41,"ion-grid")(42,"ion-row")(43,"ion-col")(44,"ion-item")(45,"ion-input",15),e.mxI("ngModelChange",function(s){return e.DH7(o.precoPorLitro,s)||(o.precoPorLitro=s),s}),e.bIt("ionInput",function(){return o.aoAlterarPrecoPorLitro()}),e.k0s()()(),e.j41(46,"ion-col")(47,"ion-item")(48,"ion-input",16),e.mxI("ngModelChange",function(s){return e.DH7(o.totalValueStr,s)||(o.totalValueStr=s),s}),e.bIt("ionInput",function(s){return o.formatCurrency(s)}),e.k0s()()(),e.j41(49,"ion-col")(50,"ion-item")(51,"ion-input",17),e.mxI("ngModelChange",function(s){return e.DH7(o.liters,s)||(o.liters=s),s}),e.k0s()()()()(),e.j41(52,"ion-item")(53,"ion-input",18),e.mxI("ngModelChange",function(s){return e.DH7(o.motorista,s)||(o.motorista=s),s}),e.k0s()(),e.j41(54,"ion-item")(55,"ion-textarea",19),e.mxI("ngModelChange",function(s){return e.DH7(o.observations,s)||(o.observations=s),s}),e.k0s()(),e.j41(56,"ion-button",20),e.bIt("click",function(){return o.save()}),e.EFF(57),e.k0s(),e.j41(58,"ion-button",21),e.bIt("click",function(){return o.viewHistory()}),e.EFF(59," Hist\xf3rico "),e.k0s()()),2&t&&(e.R7$(3),e.JRh(o.isEditing?"Editar Abastecimento":"Novo Abastecimento"),e.R7$(6),e.R50("ngModel",o.selectedVehiclePlate),e.R7$(),e.Y8G("ngForOf",o.vehicles),e.R7$(8),e.Y8G("keepContentsMounted",!0),e.R7$(7),e.Y8G("keepContentsMounted",!0),e.R7$(3),e.R50("ngModel",o.gasStation),e.R7$(),e.Y8G("ngIf",o.exibindoCarregandoPostos),e.R7$(),e.Y8G("ngIf",o.mensagemErroPostos),e.R7$(),e.Y8G("ngIf",o.exibindoListaPostos),e.R7$(6),e.R50("ngModel",o.initialOdometer),e.R7$(2),e.R50("ngModel",o.tipoAbastecimento),e.R7$(),e.Y8G("ngForOf",o.opcoesAbastecimento),e.R7$(5),e.R50("ngModel",o.precoPorLitro),e.R7$(3),e.R50("ngModel",o.totalValueStr),e.R7$(3),e.R50("ngModel",o.liters),e.R7$(2),e.R50("ngModel",o.motorista),e.R7$(2),e.R50("ngModel",o.observations),e.R7$(2),e.SpI(" ",o.isEditing?"Atualizar":"Salvar"," "))},dependencies:[j.YU,j.Sq,j.bT,O.BC,O.vS,i.Jm,i.QW,i.hU,i.W9,i.A9,i.K4,i.lO,i.eU,i.$w,i.uz,i.he,i.nf,i.ln,i.Nm,i.Ip,i.w2,i.nc,i.BC,i.ai,i.Sb,i.su,i.Je,i.Gw,j.Pc],styles:[".lista-posto-autocomplete[_ngcontent-%COMP%]{border:1px solid rgba(0,0,0,.08);border-radius:8px;margin-top:4px;overflow:hidden}.lista-posto-autocomplete[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--min-height: 44px;--padding-start: 12px;--inner-padding-end: 12px}.lista-posto-autocomplete[_ngcontent-%COMP%]   ion-item.item-zebrado[_ngcontent-%COMP%]{--background: rgba(0, 0, 0, .02)}.logo-posto[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:16px;background:var(--ion-color-primary, #3880ff);display:flex;align-items:center;justify-content:center;color:#fff;font-size:16px;font-weight:600;margin-right:8px}.logo-posto[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{line-height:1}.logo-posto.ipiranga[_ngcontent-%COMP%]{background:#ffd400;color:#000}.logo-posto.petrobras[_ngcontent-%COMP%]{background:#1fa84e;color:#fff}.logo-posto.petrobras[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px;font-weight:700}.logo-posto.shell[_ngcontent-%COMP%]{background:#d32f2f;color:#fff}.nome-posto[_ngcontent-%COMP%]{font-weight:600;font-size:14px}.endereco-posto[_ngcontent-%COMP%]{font-size:12px;color:var(--ion-color-medium, #808080);margin-top:2px}"]}),m})()},5355(D,C,d){d.d(C,{k:()=>l});var v=d(467),b=d(7343),P=d(2200),f=d(2615),h=d(3664);let S=(()=>{var e;class n{}return(e=n).\u0275fac=function(r){return new(r||e)},e.\u0275cmp=h.VBU({type:e,selectors:[["app-ajuda-odometro-popover"]],decls:2,vars:0,consts:[[1,"conteudo-ajuda-odometro"]],template:function(r,u){1&r&&(h.rj2(0,"div",0),h.EFF(1," Od\xf4metro \xe9 o indicador que registra a quilometragem total do ve\xedculo desde zero. Voc\xea pode ver esse n\xfamero no painel, pr\xf3ximo ao veloc\xedmetro. "),h.eux())},dependencies:[P.MD,b.bv],encapsulation:2}),n})(),l=(()=>{var e;class n{constructor(r){this.controlador_popover=r}mostrarAjudaOdometro(r){var u=this;return(0,v.A)(function*(){yield(yield u.controlador_popover.create({component:S,event:r,side:"right",alignment:"center",showBackdrop:!1,cssClass:"popover-ajuda-odometro"})).present()})()}}return(e=n).\u0275fac=function(r){return new(r||e)(f.KVO(b.IE))},e.\u0275prov=f.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),n})()},8254(D,C,d){d.d(C,{Y:()=>f});var v=d(467);function f(h=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},void 0===window.Capacitor||h?void 0!==window.cordova&&function P(h){h.CapacitorUtils.Synapse=new Proxy({},{get:(S,l)=>h.cordova.plugins[l]})}(window):function b(h){h.CapacitorUtils.Synapse=new Proxy({},{get:(S,l)=>new Proxy({},{get:(e,n)=>(i,r,u)=>{const y=h.Capacitor.Plugins[l];void 0!==y?"function"==typeof y[n]?(0,v.A)(function*(){try{const V=yield y[n](i);r(V)}catch(V){u(V)}})():u(new Error("Method ".concat(n," not found in Capacitor plugin ").concat(l))):u(new Error("Capacitor plugin ".concat(l," not found")))}})})}(window))}},9198(D,C,d){d.d(C,{K:()=>P});var v=d(4412),b=d(2615);let P=(()=>{var f;class h{constructor(){this.vehicles=[],this.vehiclesSubject=new v.t([]),this.STORAGE_KEY="kmrodados_vehicles",this.loadVehicles()}loadVehicles(){const l=localStorage.getItem(this.STORAGE_KEY);l&&this.processLoadedVehicles(JSON.parse(l))}processLoadedVehicles(l){this.vehicles=l.map(e=>({...e,plate:e.plate?e.plate.toUpperCase():e.plate})),this.vehicles.forEach(e=>{e.supplies&&e.supplies.forEach(n=>{n.date=new Date(n.date),n.id||(n.id=this.generateId())}),e.consumptionHistory&&e.consumptionHistory.forEach(n=>{n.date=new Date(n.date),n.id||(n.id=this.generateId())}),e.maintenance&&e.maintenance.forEach(n=>{n.date=new Date(n.date),n.id||(n.id=this.generateId())})}),this.vehiclesSubject.next(this.vehicles)}importBackup(l){try{const e=JSON.parse(l);return!(!Array.isArray(e)||!e.every(i=>i.hasOwnProperty("plate")&&i.hasOwnProperty("model"))||(this.processLoadedVehicles(e),this.saveVehicles(),0))}catch(e){return console.error("Error importing backup:",e),!1}}clearAllData(){this.vehicles=[],this.vehiclesSubject.next(this.vehicles),localStorage.removeItem(this.STORAGE_KEY)}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}saveVehicles(){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.vehicles))}getVehicles(){return this.vehiclesSubject.asObservable()}addVehicle(l){const e=l.plate.toUpperCase();l.plate=e,0===this.vehicles.length&&(l.isDefault=!0),l.createdAt||(l.createdAt=Date.now()),this.vehicles.push({...l,supplies:[]}),this.vehiclesSubject.next(this.vehicles),this.saveVehicles()}setDefaultVehicle(l){const e=l.toUpperCase();let n=!1;this.vehicles.forEach(i=>{i.plate===e?i.isDefault||(i.isDefault=!0,n=!0):i.isDefault&&(i.isDefault=!1,n=!0)}),n&&(this.vehiclesSubject.next(this.vehicles),this.saveVehicles())}addConsumptionRecord(l,e){const n=l.toUpperCase(),i=this.vehicles.find(r=>r.plate===n);return!!i&&(i.consumptionHistory||(i.consumptionHistory=[]),e.id||(e.id=this.generateId()),e.createdAt||(e.createdAt=Date.now()),i.consumptionHistory.push(e),this.vehiclesSubject.next([...this.vehicles]),this.saveVehicles(),!0)}updateVehicle(l,e){const n=l.toUpperCase(),i=e.plate.toUpperCase();e.plate=i;const r=this.vehicles.findIndex(u=>u.plate===n);if(-1!==r){const u=this.vehicles[r].supplies||[];this.vehicles[r]={...e,supplies:u},this.vehiclesSubject.next(this.vehicles),this.saveVehicles()}}deleteVehicle(l){const e=l.toUpperCase(),n=this.vehicles.findIndex(i=>i.plate===e);-1!==n&&(this.vehicles.splice(n,1),this.vehiclesSubject.next(this.vehicles),this.saveVehicles())}addSupply(l,e){const n=l.toUpperCase(),i=this.vehicles.find(r=>r.plate===n);return i?(i.supplies||(i.supplies=[]),e.id||(e.id=this.generateId()),e.createdAt||(e.createdAt=Date.now()),i.supplies.push(e),this.vehiclesSubject.next([...this.vehicles]),this.saveVehicles(),!0):(console.error("Vehicle not found for plate:",n),!1)}addTrip(l,e){const n=l.toUpperCase(),i=this.vehicles.find(r=>r.plate===n);return i?(i.trips||(i.trips=[]),e.id||(e.id=this.generateId()),e.createdAt||(e.createdAt=Date.now()),i.trips.push(e),this.vehiclesSubject.next([...this.vehicles]),this.saveVehicles(),!0):(console.error("Vehicle not found for plate:",l),!1)}addMaintenance(l,e){const n=l.toUpperCase(),i=this.vehicles.find(r=>r.plate===n);return!!i&&(i.maintenance||(i.maintenance=[]),e.id||(e.id=this.generateId()),e.createdAt||(e.createdAt=Date.now()),i.maintenance.push(e),this.vehiclesSubject.next([...this.vehicles]),this.saveVehicles(),!0)}removerAbastecimento(l,e){const n=l.toUpperCase(),i=this.vehicles.find(r=>r.plate===n);if(i&&i.supplies){const r=i.supplies.findIndex(u=>u.id===e);if(-1!==r)return i.supplies.splice(r,1),this.vehiclesSubject.next([...this.vehicles]),this.saveVehicles(),!0}return!1}removerManutencao(l,e){const n=l.toUpperCase(),i=this.vehicles.find(r=>r.plate===n);if(i&&i.maintenance){const r=i.maintenance.findIndex(u=>u.id===e);if(-1!==r)return i.maintenance.splice(r,1),this.vehiclesSubject.next([...this.vehicles]),this.saveVehicles(),!0}return!1}updateSupply(l,e){const n=l.toUpperCase(),i=this.vehicles.find(r=>r.plate===n);if(i&&i.supplies){const r=i.supplies.findIndex(u=>u.id===e.id);if(-1!==r)return i.supplies[r]=e,this.vehiclesSubject.next(this.vehicles),this.saveVehicles(),!0}return!1}updateMaintenance(l,e){const n=l.toUpperCase(),i=this.vehicles.find(r=>r.plate===n);if(i&&i.maintenance){const r=i.maintenance.findIndex(u=>u.id===e.id);if(-1!==r)return i.maintenance[r]=e,this.vehiclesSubject.next(this.vehicles),this.saveVehicles(),!0}return!1}updateConsumptionRecord(l,e){const n=l.toUpperCase(),i=this.vehicles.find(r=>r.plate===n);if(i&&i.consumptionHistory){const r=i.consumptionHistory.findIndex(u=>u.id===e.id);if(-1!==r)return i.consumptionHistory[r]=e,this.vehiclesSubject.next(this.vehicles),this.saveVehicles(),!0}return!1}updateTrip(l,e){const n=l.toUpperCase(),i=this.vehicles.find(r=>r.plate===n);if(i&&i.trips){const r=i.trips.findIndex(u=>u.id===e.id);if(-1!==r)return i.trips[r]=e,this.vehiclesSubject.next(this.vehicles),this.saveVehicles(),!0}return!1}getVehicleTypeName(l){return{car:"Carro",motorcycle:"Moto",truck:"Caminh\xe3o",bus:"\xd4nibus",van:"Van"}[l]||l}getVehicleIcon(l){switch(l){case"car":default:return"car-sport-outline";case"motorcycle":return"moto-custom";case"truck":return"truck-heavy";case"bus":return"bus-outline";case"van":return"car-outline"}}}return(f=h).\u0275fac=function(l){return new(l||f)},f.\u0275prov=b.jDH({token:f,factory:f.\u0275fac,providedIn:"root"}),h})()}}]);