"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4985],{3085(R,g,r){r.d(g,{O:()=>d});var M=r(467),t=r(2615),e=r(3664),c=r(7343),C=r(9198),_=r(6991),h=r(2200),p=r(4341);function V(m,l){if(1&m&&(e.j41(0,"ion-select-option",16),e.EFF(1),e.nI1(2,"uppercase"),e.k0s()),2&m){const a=l.$implicit;e.Y8G("value",a.plate),e.R7$(),e.Lme("",a.model," (",e.bMT(2,3,a.plate),")")}}function u(m,l){if(1&m){const a=e.RV6();e.j41(0,"ion-datetime",17),e.mxI("ngModelChange",function(n){t.eBV(a);const s=e.XpG();return e.DH7(s.maintDate,n)||(s.maintDate=n),t.Njj(n)}),e.k0s()}if(2&m){const a=e.XpG();e.R50("ngModel",a.maintDate)}}let d=(()=>{var m;class l{constructor(i,n,s,o,f){this.modalCtrl=i,this.vehicleService=n,this.alertCtrl=s,this.toastCtrl=o,this.router=f,this.vehicles=[],this.editingMaintenance=null,this.editingVehiclePlate=null,this.maintDate="",this.maintVehicle="",this.maintOdometer=null,this.maintSummary="",this.maintParts="",this.maintPartsValue=null,this.maintPartsValueStr="",this.maintServiceValue=null,this.maintServiceValueStr="",this.maintTotalValue=null,this.maintTotalValueStr="",this.isEditing=!1}ngOnInit(){if(this.initDate(),this.editingMaintenance&&this.editingVehiclePlate)this.isEditing=!0,this.loadMaintenance(this.editingMaintenance);else if(this.editingVehiclePlate)this.maintVehicle=this.editingVehiclePlate;else if(this.vehicles.length>0){const i=this.vehicles.find(n=>n.isDefault);this.maintVehicle=i?i.plate:this.vehicles[0].plate}}set preSelectedPlate(i){i&&(this.maintVehicle=i)}initDate(){const i=new Date,n=6e4*i.getTimezoneOffset();this.maintDate=new Date(i.getTime()-n).toISOString()}loadMaintenance(i){this.maintVehicle=this.editingVehiclePlate;const n=new Date(i.date),s=6e4*n.getTimezoneOffset();this.maintDate=new Date(n.getTime()-s).toISOString(),this.maintOdometer=i.odometer,this.maintSummary=i.summary,this.maintParts=i.parts||"",this.maintPartsValue=i.partsValue||null,this.maintPartsValueStr=this.maintPartsValue?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(this.maintPartsValue):"",this.maintServiceValue=i.serviceValue||null,this.maintServiceValueStr=this.maintServiceValue?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(this.maintServiceValue):"",this.maintTotalValue=i.totalValue,this.maintTotalValueStr=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(this.maintTotalValue)}close(){this.modalCtrl.dismiss()}handleCurrencyInput(i,n){let s=i.target.value;if(s=s.replace(/\D/g,""),""===s)return this[n]="","maintPartsValueStr"===n&&(this.maintPartsValue=null),"maintServiceValueStr"===n&&(this.maintServiceValue=null),void this.updateMaintenanceTotal();const o=parseInt(s,10)/100;this[n]=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o),"maintPartsValueStr"===n&&(this.maintPartsValue=o),"maintServiceValueStr"===n&&(this.maintServiceValue=o),this.updateMaintenanceTotal()}updateMaintenanceTotal(){this.maintTotalValue=(this.maintPartsValue||0)+(this.maintServiceValue||0),this.maintTotalValueStr=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(this.maintTotalValue)}save(){var i=this;return(0,M.A)(function*(){if(!(i.maintVehicle&&i.maintDate&&i.maintOdometer&&i.maintSummary&&i.maintTotalValue))return void(yield(yield i.alertCtrl.create({header:"Aten\xe7\xe3o",message:"Preencha os campos obrigat\xf3rios (Ve\xedculo, Data, Od\xf4metro, Resumo e Valores).",buttons:["OK"]})).present());const n=i.maintDate.split("T")[0],[s,o,f]=n.split("-").map(Number),D=new Date(s,o-1,f),E={id:i.isEditing?i.editingMaintenance.id:void 0,date:D,odometer:i.maintOdometer,summary:i.maintSummary,parts:i.maintParts,partsValue:i.maintPartsValue||0,serviceValue:i.maintServiceValue||0,totalValue:i.maintTotalValue};i.isEditing?i.vehicleService.updateMaintenance(i.maintVehicle,E):i.vehicleService.addMaintenance(i.maintVehicle,E),yield(yield i.toastCtrl.create({message:i.isEditing?"Manuten\xe7\xe3o atualizada com sucesso!":"Manuten\xe7\xe3o registrada com sucesso!",duration:2e3,position:"bottom",color:"success"})).present(),i.modalCtrl.dismiss({saved:!0})})()}viewHistory(){this.modalCtrl.dismiss({action:"view_history"})}}return(m=l).\u0275fac=function(i){return new(i||m)(e.rXU(c.W3),e.rXU(C.K),e.rXU(c.hG),e.rXU(c.K_),e.rXU(_.Ix))},m.\u0275cmp=e.VBU({type:m,selectors:[["app-maintenance-modal"]],inputs:{vehicles:"vehicles",editingMaintenance:"editingMaintenance",editingVehiclePlate:"editingVehiclePlate",preSelectedPlate:"preSelectedPlate"},standalone:!1,decls:33,vars:11,consts:[["slot","end"],[3,"click"],[1,"ion-padding"],["label","Ve\xedculo","label-placement","stacked",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["position","stacked"],["datetime","maint-datetime"],[3,"keepContentsMounted"],["type","number","inputmode","numeric","label","Od\xf4metro (km)","label-placement","stacked",3,"ngModelChange","ngModel"],["label","Resumo do Servi\xe7o","label-placement","stacked","placeholder","Ex: Troca de \xf3leo",3,"ngModelChange","ngModel"],["label","Pe\xe7as / Detalhes","label-placement","stacked","placeholder","Ex: Filtro de \xf3leo, 4L \xf3leo 5w30...",3,"ngModelChange","ngModel"],["type","tel","inputmode","decimal","label","Valor Pe\xe7as (R$)","label-placement","stacked","placeholder","R$ 0,00",3,"ngModelChange","ionInput","ngModel"],["type","tel","inputmode","decimal","label","Valor M\xe3o de Obra (R$)","label-placement","stacked","placeholder","R$ 0,00",3,"ngModelChange","ionInput","ngModel"],["label","Valor Total (R$)","label-placement","stacked","readonly","",3,"ngModelChange","ngModel"],["expand","block",1,"ion-margin-top",3,"click"],["expand","block","fill","outline",1,"ion-margin-top",3,"click"],[3,"value"],["id","maint-datetime","presentation","date","locale","pt-BR",3,"ngModelChange","ngModel"]],template:function(i,n){1&i&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",0)(5,"ion-button",1),e.bIt("click",function(){return n.close()}),e.EFF(6,"Fechar"),e.k0s()()()(),e.j41(7,"ion-content",2)(8,"ion-item")(9,"ion-select",3),e.mxI("ngModelChange",function(o){return e.DH7(n.maintVehicle,o)||(n.maintVehicle=o),o}),e.DNE(10,V,3,5,"ion-select-option",4),e.k0s()(),e.j41(11,"ion-item")(12,"ion-label",5),e.EFF(13,"Data"),e.k0s(),e.nrm(14,"ion-datetime-button",6),e.j41(15,"ion-modal",7),e.DNE(16,u,1,1,"ng-template"),e.k0s()(),e.j41(17,"ion-item")(18,"ion-input",8),e.mxI("ngModelChange",function(o){return e.DH7(n.maintOdometer,o)||(n.maintOdometer=o),o}),e.k0s()(),e.j41(19,"ion-item")(20,"ion-input",9),e.mxI("ngModelChange",function(o){return e.DH7(n.maintSummary,o)||(n.maintSummary=o),o}),e.k0s()(),e.j41(21,"ion-item")(22,"ion-textarea",10),e.mxI("ngModelChange",function(o){return e.DH7(n.maintParts,o)||(n.maintParts=o),o}),e.k0s()(),e.j41(23,"ion-item")(24,"ion-input",11),e.mxI("ngModelChange",function(o){return e.DH7(n.maintPartsValueStr,o)||(n.maintPartsValueStr=o),o}),e.bIt("ionInput",function(o){return n.handleCurrencyInput(o,"maintPartsValueStr")}),e.k0s()(),e.j41(25,"ion-item")(26,"ion-input",12),e.mxI("ngModelChange",function(o){return e.DH7(n.maintServiceValueStr,o)||(n.maintServiceValueStr=o),o}),e.bIt("ionInput",function(o){return n.handleCurrencyInput(o,"maintServiceValueStr")}),e.k0s()(),e.j41(27,"ion-item")(28,"ion-input",13),e.mxI("ngModelChange",function(o){return e.DH7(n.maintTotalValueStr,o)||(n.maintTotalValueStr=o),o}),e.k0s()(),e.j41(29,"ion-button",14),e.bIt("click",function(){return n.save()}),e.EFF(30),e.k0s(),e.j41(31,"ion-button",15),e.bIt("click",function(){return n.viewHistory()}),e.EFF(32," Hist\xf3rico "),e.k0s()()),2&i&&(e.R7$(3),e.JRh(n.isEditing?"Editar Manuten\xe7\xe3o":"Nova Manuten\xe7\xe3o"),e.R7$(6),e.R50("ngModel",n.maintVehicle),e.R7$(),e.Y8G("ngForOf",n.vehicles),e.R7$(5),e.Y8G("keepContentsMounted",!0),e.R7$(3),e.R50("ngModel",n.maintOdometer),e.R7$(2),e.R50("ngModel",n.maintSummary),e.R7$(2),e.R50("ngModel",n.maintParts),e.R7$(2),e.R50("ngModel",n.maintPartsValueStr),e.R7$(2),e.R50("ngModel",n.maintServiceValueStr),e.R7$(2),e.R50("ngModel",n.maintTotalValueStr),e.R7$(2),e.SpI(" ",n.isEditing?"Atualizar":"Salvar"," "))},dependencies:[h.Sq,p.BC,p.vS,c.Jm,c.QW,c.W9,c.A9,c.K4,c.eU,c.$w,c.uz,c.he,c.Nm,c.Ip,c.nc,c.BC,c.ai,c.Sb,c.su,c.Je,c.Gw,h.Pc],encapsulation:2}),l})()},7949(R,g,r){r.d(g,{u:()=>V});var M=r(467),t=r(3664),e=r(7343),c=r(9198),C=r(5355),_=r(2200),h=r(4341);function p(u,d){if(1&u&&(t.j41(0,"ion-select-option",14),t.EFF(1),t.nI1(2,"uppercase"),t.k0s()),2&u){const m=d.$implicit;t.Y8G("value",m.plate),t.R7$(),t.Lme("",m.model," (",t.bMT(2,3,m.plate),")")}}let V=(()=>{var u;class d{constructor(l,a,i,n,s){this.modalCtrl=l,this.vehicleService=a,this.alertCtrl=i,this.toastCtrl=n,this.ajuda_odometro=s,this.vehicles=[],this.editingRecord=null,this.editingVehiclePlate=null,this.calcSelectedVehicle="",this.calcInitialOdometer=null,this.calcFinalOdometer=null,this.calcDist=null,this.calcLiters=null,this.calcResult=null,this.isEditing=!1}ngOnInit(){if(this.editingRecord&&this.editingVehiclePlate)this.isEditing=!0,this.loadRecord(this.editingRecord);else if(this.editingVehiclePlate)this.calcSelectedVehicle=this.editingVehiclePlate;else if(this.vehicles.length>0){const l=this.vehicles.find(a=>a.isDefault);this.calcSelectedVehicle=l?l.plate:this.vehicles[0].plate}}set preSelectedPlate(l){l&&(this.calcSelectedVehicle=l)}loadRecord(l){this.calcSelectedVehicle=this.editingVehiclePlate,this.calcInitialOdometer=l.initialOdometer||null,this.calcFinalOdometer=l.finalOdometer||null,this.calcDist=l.distance,this.calcLiters=l.liters,this.calcResult=l.result}close(){this.modalCtrl.dismiss()}updateDistance(){null!==this.calcInitialOdometer&&null!==this.calcFinalOdometer&&(this.calcDist=this.calcFinalOdometer-this.calcInitialOdometer),this.calculateConsumption()}calculateConsumption(){this.calcResult=this.calcDist&&this.calcLiters&&this.calcLiters>0?this.calcDist/this.calcLiters:null}save(){var l=this;return(0,M.A)(function*(){var a,i;if(!(l.calcSelectedVehicle&&l.calcResult&&l.calcDist&&l.calcLiters))return void(yield(yield l.alertCtrl.create({header:"Campos Obrigat\xf3rios",message:"Por favor, selecione um ve\xedculo e certifique-se que o c\xe1lculo foi realizado.",buttons:["OK"]})).present());const n={id:l.isEditing?l.editingRecord.id:void 0,date:new Date,initialOdometer:null!==(a=l.calcInitialOdometer)&&void 0!==a?a:void 0,finalOdometer:null!==(i=l.calcFinalOdometer)&&void 0!==i?i:void 0,distance:l.calcDist,liters:l.calcLiters,result:l.calcResult};l.isEditing?l.vehicleService.updateConsumptionRecord(l.calcSelectedVehicle,n):l.vehicleService.addConsumptionRecord(l.calcSelectedVehicle,n),yield(yield l.toastCtrl.create({message:l.isEditing?"Registro atualizado com sucesso!":"M\xe9dia de consumo salva com sucesso!",duration:2e3,position:"bottom",color:"success"})).present(),l.modalCtrl.dismiss({saved:!0})})()}viewHistory(){this.modalCtrl.dismiss({action:"view_history"})}}return(u=d).\u0275fac=function(l){return new(l||u)(t.rXU(e.W3),t.rXU(c.K),t.rXU(e.hG),t.rXU(e.K_),t.rXU(C.k))},u.\u0275cmp=t.VBU({type:u,selectors:[["app-consumption-modal"]],inputs:{vehicles:"vehicles",editingRecord:"editingRecord",editingVehiclePlate:"editingVehiclePlate",preSelectedPlate:"preSelectedPlate"},standalone:!1,decls:38,vars:11,consts:[["slot","end"],[3,"click"],[1,"ion-padding"],["label","Ve\xedculo","label-placement","stacked",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["position","stacked"],["tabindex","0",1,"icone-ajuda-odometro",3,"click"],["type","number","inputmode","numeric",3,"ngModelChange","ionChange","ngModel"],["type","number","inputmode","numeric","label","Dist\xe2ncia Percorrida (km)","label-placement","stacked","readonly","",3,"ngModelChange","ngModel"],["type","number","inputmode","decimal","label","Litros Abastecidos","label-placement","stacked",3,"ngModelChange","ionChange","ngModel"],["lines","none"],[2,"font-size","24px","font-weight","bold","color","var(--ion-color-primary)"],["expand","block",1,"ion-margin-top",3,"click","disabled"],["expand","block","fill","outline",1,"ion-margin-top",3,"click"],[3,"value"]],template:function(l,a){1&l&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"C\xe1lculo de Consumo"),t.k0s(),t.j41(4,"ion-buttons",0)(5,"ion-button",1),t.bIt("click",function(){return a.close()}),t.EFF(6,"Fechar"),t.k0s()()()(),t.j41(7,"ion-content",2)(8,"ion-item")(9,"ion-select",3),t.mxI("ngModelChange",function(n){return t.DH7(a.calcSelectedVehicle,n)||(a.calcSelectedVehicle=n),n}),t.DNE(10,p,3,5,"ion-select-option",4),t.k0s()(),t.j41(11,"ion-item")(12,"ion-label",5),t.EFF(13," Od\xf4metro Inicial (km) "),t.j41(14,"span",6),t.bIt("click",function(n){return a.ajuda_odometro.mostrarAjudaOdometro(n)}),t.EFF(15,"?"),t.k0s()(),t.j41(16,"ion-input",7),t.mxI("ngModelChange",function(n){return t.DH7(a.calcInitialOdometer,n)||(a.calcInitialOdometer=n),n}),t.bIt("ionChange",function(){return a.updateDistance()}),t.k0s()(),t.j41(17,"ion-item")(18,"ion-label",5),t.EFF(19," Od\xf4metro Final (km) "),t.j41(20,"span",6),t.bIt("click",function(n){return a.ajuda_odometro.mostrarAjudaOdometro(n)}),t.EFF(21,"?"),t.k0s()(),t.j41(22,"ion-input",7),t.mxI("ngModelChange",function(n){return t.DH7(a.calcFinalOdometer,n)||(a.calcFinalOdometer=n),n}),t.bIt("ionChange",function(){return a.updateDistance()}),t.k0s()(),t.j41(23,"ion-item")(24,"ion-input",8),t.mxI("ngModelChange",function(n){return t.DH7(a.calcDist,n)||(a.calcDist=n),n}),t.k0s()(),t.j41(25,"ion-item")(26,"ion-input",9),t.mxI("ngModelChange",function(n){return t.DH7(a.calcLiters,n)||(a.calcLiters=n),n}),t.bIt("ionChange",function(){return a.calculateConsumption()}),t.k0s()(),t.j41(27,"ion-item",10)(28,"ion-label")(29,"h2"),t.EFF(30,"M\xe9dia de Consumo"),t.k0s(),t.j41(31,"p",11),t.EFF(32),t.nI1(33,"number"),t.k0s()()(),t.j41(34,"ion-button",12),t.bIt("click",function(){return a.save()}),t.EFF(35," Salvar "),t.k0s(),t.j41(36,"ion-button",13),t.bIt("click",function(){return a.viewHistory()}),t.EFF(37," Hist\xf3rico "),t.k0s()()),2&l&&(t.R7$(9),t.R50("ngModel",a.calcSelectedVehicle),t.R7$(),t.Y8G("ngForOf",a.vehicles),t.R7$(6),t.R50("ngModel",a.calcInitialOdometer),t.R7$(6),t.R50("ngModel",a.calcFinalOdometer),t.R7$(2),t.R50("ngModel",a.calcDist),t.R7$(2),t.R50("ngModel",a.calcLiters),t.R7$(6),t.SpI(" ",a.calcResult?t.i5U(33,8,a.calcResult,"1.2-2")+" km/l":"--"," "),t.R7$(2),t.Y8G("disabled",!a.calcResult))},dependencies:[_.Sq,h.BC,h.vS,e.Jm,e.QW,e.W9,e.eU,e.$w,e.uz,e.he,e.Nm,e.Ip,e.BC,e.ai,e.su,e.Je,_.Pc,_.QX],encapsulation:2}),d})()}}]);