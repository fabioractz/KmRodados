"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2173],{2173(P,g,u){u.d(g,{ConsumptionHistoryPageModule:()=>V});var f=u(2200),y=u(4341),d=u(7343),p=u(8132),t=u(3664),C=u(9198);function s(a,h){1&a&&(t.j41(0,"div",4)(1,"p"),t.EFF(2,"Nenhum registro de consumo encontrado."),t.k0s()())}function e(a,h){if(1&a&&(t.j41(0,"p"),t.EFF(1),t.k0s()),2&a){const c=t.XpG().$implicit;t.R7$(),t.Lme(" ",c.distance," km / ",c.liters," L ")}}function n(a,h){if(1&a&&(t.j41(0,"ion-item")(1,"ion-label")(2,"h2"),t.EFF(3),t.j41(4,"small"),t.EFF(5),t.k0s()(),t.j41(6,"p")(7,"strong"),t.EFF(8,"Data:"),t.k0s(),t.EFF(9),t.nI1(10,"date"),t.k0s(),t.j41(11,"p")(12,"strong"),t.EFF(13,"M\xe9dia:"),t.k0s(),t.EFF(14),t.nI1(15,"number"),t.k0s(),t.DNE(16,e,2,2,"p",3),t.k0s()()),2&a){const c=h.$implicit;t.R7$(3),t.SpI("",c.vehicleModel," "),t.R7$(2),t.SpI("(",c.vehiclePlate,")"),t.R7$(4),t.SpI(" ",t.i5U(10,5,c.date,"dd/MM/yyyy")),t.R7$(5),t.SpI(" ",t.i5U(15,8,c.result,"1.2-2")," km/l"),t.R7$(2),t.Y8G("ngIf",c.distance&&c.liters)}}function i(a,h){if(1&a&&(t.j41(0,"ion-list"),t.DNE(1,n,17,11,"ion-item",5),t.k0s()),2&a){const c=t.XpG();t.R7$(),t.Y8G("ngForOf",c.records)}}let o=(()=>{var a;class h{constructor(l){this.vehicleService=l,this.records=[]}ngOnInit(){this.vehicleService.getVehicles().subscribe(l=>{this.records=this.flattenRecords(l)})}flattenRecords(l){const v=[];return l.forEach(m=>{m.consumptionHistory&&m.consumptionHistory.forEach(S=>{v.push({...S,vehicleModel:m.model,vehiclePlate:m.plate})})}),v.sort((m,S)=>new Date(S.date).getTime()-new Date(m.date).getTime())}}return(a=h).\u0275fac=function(l){return new(l||a)(t.rXU(C.K))},a.\u0275cmp=t.VBU({type:a,selectors:[["app-consumption-history"]],standalone:!1,decls:9,vars:2,consts:[["slot","start"],["defaultHref","/tabs/home"],["class","ion-padding ion-text-center",4,"ngIf"],[4,"ngIf"],[1,"ion-padding","ion-text-center"],[4,"ngFor","ngForOf"]],template:function(l,v){1&l&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t.nrm(3,"ion-back-button",1),t.k0s(),t.j41(4,"ion-title"),t.EFF(5,"Hist\xf3rico de Consumo"),t.k0s()()(),t.j41(6,"ion-content"),t.DNE(7,s,3,0,"div",2)(8,i,2,1,"ion-list",3),t.k0s()),2&l&&(t.R7$(7),t.Y8G("ngIf",0===v.records.length),t.R7$(),t.Y8G("ngIf",v.records.length>0))},dependencies:[f.Sq,f.bT,d.QW,d.W9,d.eU,d.uz,d.he,d.nf,d.BC,d.ai,d.el,f.QX,f.vh],encapsulation:2}),h})();var r=u(2615);const x=[{path:"",component:o}];let I=(()=>{var a;class h{}return(a=h).\u0275fac=function(l){return new(l||a)},a.\u0275mod=t.$C({type:a}),a.\u0275inj=r.G2t({imports:[p.iI.forChild(x),p.iI]}),h})(),V=(()=>{var a;class h{}return(a=h).\u0275fac=function(l){return new(l||a)},a.\u0275mod=t.$C({type:a}),a.\u0275inj=r.G2t({imports:[f.MD,y.YN,d.bv,I]}),h})()},9198(P,g,u){u.d(g,{K:()=>d});var f=u(4412),y=u(2615);let d=(()=>{var p;class t{constructor(){this.vehicles=[],this.vehiclesSubject=new f.t([]),this.STORAGE_KEY="kmrodados_vehicles",this.loadVehicles()}loadVehicles(){const s=localStorage.getItem(this.STORAGE_KEY);s&&this.processLoadedVehicles(JSON.parse(s))}processLoadedVehicles(s){this.vehicles=s.map(e=>({...e,plate:e.plate?e.plate.toUpperCase():e.plate})),this.vehicles.forEach(e=>{e.supplies&&e.supplies.forEach(n=>{n.date=new Date(n.date),n.id||(n.id=this.generateId())}),e.consumptionHistory&&e.consumptionHistory.forEach(n=>{n.date=new Date(n.date),n.id||(n.id=this.generateId())}),e.maintenance&&e.maintenance.forEach(n=>{n.date=new Date(n.date),n.id||(n.id=this.generateId())})}),this.vehiclesSubject.next(this.vehicles)}importBackup(s){try{const e=JSON.parse(s);return!(!Array.isArray(e)||!e.every(i=>i.hasOwnProperty("plate")&&i.hasOwnProperty("model"))||(this.processLoadedVehicles(e),this.saveVehicles(),0))}catch(e){return console.error("Error importing backup:",e),!1}}clearAllData(){this.vehicles=[],this.vehiclesSubject.next(this.vehicles),localStorage.removeItem(this.STORAGE_KEY)}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}saveVehicles(){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.vehicles))}getVehicles(){return this.vehiclesSubject.asObservable()}addVehicle(s){const e=s.plate.toUpperCase();s.plate=e,0===this.vehicles.length&&(s.isDefault=!0),s.createdAt||(s.createdAt=Date.now()),this.vehicles.push({...s,supplies:[]}),this.vehiclesSubject.next(this.vehicles),this.saveVehicles()}setDefaultVehicle(s){const e=s.toUpperCase();let n=!1;this.vehicles.forEach(i=>{i.plate===e?i.isDefault||(i.isDefault=!0,n=!0):i.isDefault&&(i.isDefault=!1,n=!0)}),n&&(this.vehiclesSubject.next(this.vehicles),this.saveVehicles())}addConsumptionRecord(s,e){const n=s.toUpperCase(),i=this.vehicles.find(o=>o.plate===n);return!!i&&(i.consumptionHistory||(i.consumptionHistory=[]),e.id||(e.id=this.generateId()),e.createdAt||(e.createdAt=Date.now()),i.consumptionHistory.push(e),this.vehiclesSubject.next([...this.vehicles]),this.saveVehicles(),!0)}updateVehicle(s,e){const n=s.toUpperCase(),i=e.plate.toUpperCase();e.plate=i;const o=this.vehicles.findIndex(r=>r.plate===n);if(-1!==o){const r=this.vehicles[o].supplies||[];this.vehicles[o]={...e,supplies:r},this.vehiclesSubject.next(this.vehicles),this.saveVehicles()}}deleteVehicle(s){const e=s.toUpperCase(),n=this.vehicles.findIndex(i=>i.plate===e);-1!==n&&(this.vehicles.splice(n,1),this.vehiclesSubject.next(this.vehicles),this.saveVehicles())}addSupply(s,e){const n=s.toUpperCase(),i=this.vehicles.find(o=>o.plate===n);return i?(i.supplies||(i.supplies=[]),e.id||(e.id=this.generateId()),e.createdAt||(e.createdAt=Date.now()),i.supplies.push(e),this.vehiclesSubject.next([...this.vehicles]),this.saveVehicles(),!0):(console.error("Vehicle not found for plate:",n),!1)}addTrip(s,e){const n=s.toUpperCase(),i=this.vehicles.find(o=>o.plate===n);return i?(i.trips||(i.trips=[]),e.id||(e.id=this.generateId()),e.createdAt||(e.createdAt=Date.now()),i.trips.push(e),this.vehiclesSubject.next([...this.vehicles]),this.saveVehicles(),!0):(console.error("Vehicle not found for plate:",s),!1)}addMaintenance(s,e){const n=s.toUpperCase(),i=this.vehicles.find(o=>o.plate===n);return!!i&&(i.maintenance||(i.maintenance=[]),e.id||(e.id=this.generateId()),e.createdAt||(e.createdAt=Date.now()),i.maintenance.push(e),this.vehiclesSubject.next([...this.vehicles]),this.saveVehicles(),!0)}removerAbastecimento(s,e){const n=s.toUpperCase(),i=this.vehicles.find(o=>o.plate===n);if(i&&i.supplies){const o=i.supplies.findIndex(r=>r.id===e);if(-1!==o)return i.supplies.splice(o,1),this.vehiclesSubject.next([...this.vehicles]),this.saveVehicles(),!0}return!1}removerManutencao(s,e){const n=s.toUpperCase(),i=this.vehicles.find(o=>o.plate===n);if(i&&i.maintenance){const o=i.maintenance.findIndex(r=>r.id===e);if(-1!==o)return i.maintenance.splice(o,1),this.vehiclesSubject.next([...this.vehicles]),this.saveVehicles(),!0}return!1}updateSupply(s,e){const n=s.toUpperCase(),i=this.vehicles.find(o=>o.plate===n);if(i&&i.supplies){const o=i.supplies.findIndex(r=>r.id===e.id);if(-1!==o)return i.supplies[o]=e,this.vehiclesSubject.next(this.vehicles),this.saveVehicles(),!0}return!1}updateMaintenance(s,e){const n=s.toUpperCase(),i=this.vehicles.find(o=>o.plate===n);if(i&&i.maintenance){const o=i.maintenance.findIndex(r=>r.id===e.id);if(-1!==o)return i.maintenance[o]=e,this.vehiclesSubject.next(this.vehicles),this.saveVehicles(),!0}return!1}updateConsumptionRecord(s,e){const n=s.toUpperCase(),i=this.vehicles.find(o=>o.plate===n);if(i&&i.consumptionHistory){const o=i.consumptionHistory.findIndex(r=>r.id===e.id);if(-1!==o)return i.consumptionHistory[o]=e,this.vehiclesSubject.next(this.vehicles),this.saveVehicles(),!0}return!1}updateTrip(s,e){const n=s.toUpperCase(),i=this.vehicles.find(o=>o.plate===n);if(i&&i.trips){const o=i.trips.findIndex(r=>r.id===e.id);if(-1!==o)return i.trips[o]=e,this.vehiclesSubject.next(this.vehicles),this.saveVehicles(),!0}return!1}getVehicleTypeName(s){return{car:"Carro",motorcycle:"Moto",truck:"Caminh\xe3o",bus:"\xd4nibus",van:"Van"}[s]||s}getVehicleIcon(s){switch(s){case"car":default:return"car-sport-outline";case"motorcycle":return"moto-custom";case"truck":return"truck-heavy";case"bus":return"bus-outline";case"van":return"car-outline"}}}return(p=t).\u0275fac=function(s){return new(s||p)},p.\u0275prov=y.jDH({token:p,factory:p.\u0275fac,providedIn:"root"}),t})()}}]);